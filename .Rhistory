install.packages("lmtest")
install.packages("vcd")
knitr::opts_chunk$set(echo = TRUE)
# some of common options (and the defaults) are:
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right',
library(ezids)
library(dplyr)
library(lmtest)
library(vcd)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3)
# options(scipen=9, digits = 3)
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
#Import dataset
loanpredict <- read.csv("Training Data.csv", header = TRUE)
str(loanpredict)
#Convert necessary variables to factors/categoricals and set appropriate level titles
loanpredict$Married.Single <- recode_factor(loanpredict$Married.Single, single = "Single", married = "Married")
loanpredict$House_Ownership <- recode_factor(loanpredict$House_Ownership, rented = "Renting", owned = "Owning", norent_noown = "Neither")
loanpredict$Car_Ownership <- recode_factor(loanpredict$Car_Ownership, no = "No", yes = "Yes")
str(loanpredict)
#Remove variables that won't help in our analysis
loandata <- subset(loanpredict, select = -c(Id, CITY, STATE, Profession))
#Create summary table of remaining variables
xkablesummary(loandata, title = "Summary Statistics for Loan Default Prediction")
#Selecting only values where the customer defaulted
defaulted <- subset(loandata, Risk_Flag == 1)
#Selecting only values where the customer did not default
not_defaulted <- subset(loandata, Risk_Flag == 0)
#Summary for non-defaulted customers
xkablesummary(not_defaulted, title = "Summary of Data for Non-Defaulted Customers")
#Summary for defaulted customers
xkablesummary(defaulted, title = "Summary of Data for Defaulted Customers")
#Box-plot
pairs(loandata)
#Import necessary library
library(corrplot)
#Subset out numerical variables for correlation analysis
numericalloan = subset(loandata, select = c(Income, Age, Experience, CURRENT_JOB_YRS, CURRENT_HOUSE_YRS, Risk_Flag))
#Run correlation
correlation = cor(numericalloan)
#Make the plot look presentable
corrplot(cor(numericalloan), method = 'circle', type = 'upper', title = "Correlation Plot for Numerical Loan Variables")
#Import necessary library
library("ggplot2")
#Convert Risk_Flag to factor level
loandata$Risk_Flag <- recode_factor(loandata$Risk_Flag, "0" = "Non-Defaulted", "1" = "Defaulted")
ggplot(loandata, aes(x=Risk_Flag, y=Income)) +
geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4)+
labs(title="Income based on Loan Default Status",x="Default Status", y = "Income")
cont_table_housing <- table(loandata$House_Ownership, loandata$Risk_Flag)
xkabledply(cont_table_housing, title="Contingency table for Home-Ownership vs. Loan Default Status")
cont_table_marriage <- table(loandata$Married.Single, loandata$Risk_Flag)
xkabledply(cont_table_marriage, title="Contingency table for Marriage Status vs. Loan Default Status")
ggplot(loandata, aes(x=Risk_Flag, y=CURRENT_HOUSE_YRS)) +
geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4)+
labs(title="Years in Current House based on Loan Default Status",x="Default Status", y = "Years in Current House")
ggplot(loandata, aes(x=Risk_Flag, y=CURRENT_JOB_YRS)) +
geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4)+
labs(title="Years in Current Job based on Loan Default Status",x="Default Status", y = "Years in Current Job")
ggplot(loandata, aes(x=Risk_Flag, y=Experience)) +
geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4)+
labs(title="Years Overall Job Experience based on Loan Default Status",x="Default Status", y = "Total Job Experience")
ggplot(loandata, aes(x=Risk_Flag, y=Age)) +
geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4)+
labs(title="Age based on Loan Default Status",x="Default Status", y = "Age")
str(loandata)
sum(is.na(loandata$Age))
sum(is.na(loandata$Income))
sum(is.na(loandata$Experience))
sum(is.na(loandata$Married.Single))
sum(is.na(loandata$House_Ownership))
sum(is.na(loandata$Car_Ownership))
sum(is.na(loandata$CURRENT_HOUSE_YRS))
sum(is.na(loandata$CURRENT_JOB_YRS))
sum(is.na(loandata$Income))
outlierKD2(defaulted, Age, rm=TRUE, boxplt=TRUE, histogram=TRUE, qqplt=TRUE)
outlierKD2(defaulted, Income, rm=TRUE, boxplt=TRUE, histogram=TRUE, qqplt=TRUE)
outlierKD2(defaulted, Experience, rm=TRUE, boxplt=TRUE, histogram=TRUE, qqplt=TRUE)
outlierKD2(defaulted, CURRENT_JOB_YRS, rm=TRUE, boxplt=TRUE, histogram=TRUE, qqplt=TRUE)
outlierKD2(not_defaulted, Age, rm=TRUE, boxplt=TRUE, histogram=TRUE, qqplt=TRUE)
outlierKD2(not_defaulted, Income, rm=TRUE, boxplt=TRUE, histogram=TRUE, qqplt=TRUE)
outlierKD2(not_defaulted, Experience, rm=TRUE, boxplt=TRUE, histogram=TRUE, qqplt=TRUE)
outlierKD2(not_defaulted, CURRENT_JOB_YRS, rm=TRUE, boxplt=TRUE, histogram=TRUE, qqplt=TRUE)
loadPkg("gridExtra")
## Package to make graphs next to each other
#str(loandata)
ggplot(data=not_defaulted, aes(Age)) +
geom_histogram(aes(y=..density..), binwidth = 2,
col="aquamarine4",
fill="aquamarine2",
alpha = .7) +
labs(title="Non-defaulted Customers Age Histogram") +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$Age, na.rm = TRUE), sd = sd(not_defaulted$Age, na.rm = TRUE))) +
labs(x="Age", y="Frequency")
qqnorm(not_defaulted$Age, main="Q-Q plot of Age level of Not Defaulted Customers", col = 'seagreen3')
qqline(not_defaulted$Age, col = 'red')
##shapiro.test(not_defaulted$Age) sample size to big to conduct a shapiro test, not necessary according to proffesor
# ggplot(not_defaulted, aes(y=Income)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Not_Defaulted Customer Income boxplot ",x="", y = "weight (lbs)")
ggplot(data=not_defaulted, aes(Income)) +
geom_histogram(aes(y=..density..), binwidth = 7,
col="dodgerblue4",
fill="dodgerblue2",
alpha = .7) +
labs(title="Non-defaulted Customers Income Histogram") +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$Income, na.rm = TRUE), sd = sd(not_defaulted$Income, na.rm = TRUE))) +
labs(x="Income", y="Frequency")
qqnorm(not_defaulted$Income, main="Q-Q plot of Income level of Not Defaulted Customers", col = 'seagreen3')
qqline(not_defaulted$Income, col = 'red')
#str(loandata)
ggplot(data=not_defaulted, aes(Experience)) +
geom_histogram(aes(y=..density..), binwidth = 1,
col="gold4",
fill="gold2",
alpha = .7) +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$Experience), sd = sd(not_defaulted$Experience))) +
labs(title="Non-defaulted Experience Histogram") +
labs(x="Experience", y="Frequency")
# ggplot(not_defaulted, aes(y=Experience)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Not_Defaulted Customer Experience boxplot ",x="", y = "weight (lbs)")
qqnorm(not_defaulted$Experience, main="Q-Q plot of Job Experience of Not Defaulted Customers", col = 'seagreen3')
qqline(not_defaulted$Experience, col = 'red')
ggplot(data=not_defaulted, aes(CURRENT_HOUSE_YRS)) +
geom_histogram(aes(y=..density..), binwidth = 1,
col="brown4",
fill="brown2",
alpha = .7) +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$CURRENT_HOUSE_YRS, na.rm = TRUE), sd = sd(not_defaulted$CURRENT_HOUSE_YRS, na.rm = TRUE))) +
labs(title="Non-defaulted Customers years in Current Home Histogram") +
labs(x='Years in Current Home', y="Frequency")
# ggplot(not_defaulted, aes(y=CURRENT_HOUSE_YRS)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Not_Defaulted Customer Years in Current Home boxplot ",x="", y = "weight (lbs)")
qqnorm(not_defaulted$CURRENT_HOUSE_YRS, main="Q-Q plot of Years in Current Home of Not Defaulted Customers", col = 'seagreen3')
qqline(not_defaulted$CURRENT_HOUSE_YRS, col = 'red')
ggplot(data=not_defaulted, aes(CURRENT_JOB_YRS)) +
geom_histogram(aes(y=..density..), binwidth = 1,
col="burlywood4",
fill="burlywood2",
alpha = .7) +
labs(title="Non-defaulted Years in Current Job Years Histogram") +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$CURRENT_JOB_YRS, na.rm = TRUE), sd = sd(not_defaulted$CURRENT_JOB_YRS, na.rm = TRUE))) +
labs(x="Years in Current Job", y="Frequency")
# ggplot(not_defaulted, aes(y=CURRENT_JOB_YRS)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Not_Defaulted Years in Current Job boxplot ",x="", y = "weight (lbs)")
#
qqnorm(not_defaulted$CURRENT_JOB_YRS, main="Q-Q plot of Years in Current Job Years of Not Defaulted Customers", col = 'seagreen3')
qqline(not_defaulted$CURRENT_JOB_YRS, col = 'red')
ggplot(data=defaulted, aes(Age)) +
geom_histogram(aes(y=..density..),
binwidth = 1,
col="darkolivegreen4",
fill="darkolivegreen2",
alpha = .7) +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(defaulted$Age, na.rm = TRUE), sd = sd(defaulted$Age, na.rm = TRUE))) + # opacity
labs(title="Defaulted Customers Age Histogram") +
labs(x="Age", y="Frequency")
qqnorm(defaulted$Age, main="Q-Q plot of Age Defaulted Customers", col = 'royalblue2' )
qqline(defaulted$Age, col = 'red')
# ggplot(defaulted, aes(y=Income)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Defaulted Customer Income boxplot ",x="", y = "weight (lbs)")
ggplot(data=defaulted, aes(Income)) +
geom_histogram(aes(y=..density..),
col="magenta4",
fill="magenta2",
alpha = .7) +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(defaulted$Income, na.rm = TRUE), sd = sd(defaulted$Income, na.rm = TRUE))) +
labs(title="defaulted Customers Income Histogram") +
labs(x="Income", y="Frequency")
qqnorm(defaulted$Income, main="Q-Q plot of Income level of Not Defaulted Customers", col = 'royalblue2')
qqline(defaulted$Income, col = 'red')
#str(loandata)
ggplot(data=defaulted, aes(Experience)) +
geom_histogram(aes(y=..density..),
binwidth = 1,
col="darkorange4",
fill="darkorange2",
alpha = .7) +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(defaulted$Experience, na.rm = TRUE), sd = sd(defaulted$Experience, na.rm = TRUE))) +
labs(title="defaulted Experience Histogram") +
labs(x="Experience", y="Frequency")
# ggplot(defaulted, aes(y=Experience)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Defaulted Customer Experience boxplot ",x="", y = "weight (lbs)")
qqnorm(defaulted$Experience, main="Q-Q plot of Years of Job Experience of Defaulted Customers", col = 'royalblue2')
qqline(defaulted$Experience, col = 'red')
ggplot(data=defaulted, aes(CURRENT_HOUSE_YRS)) +
geom_histogram(aes(y=..density..),
binwidth = 1,
col="ivory4",
fill="ivory2",
alpha = .7) +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(defaulted$CURRENT_HOUSE_YRS, na.rm = TRUE), sd = sd(defaulted$CURRENT_HOUSE_YRS, na.rm = TRUE))) +
labs(title="defaulted Years in Current Home Histogram") +
labs(x="Experience", y="Frequency")
# ggplot(defaulted, aes(y=CURRENT_HOUSE_YRS)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Defaulted Customer Years in Current Home boxplot ",x="", y = "weight (lbs)")
qqnorm(defaulted$CURRENT_HOUSE_YRS, main="Q-Q plot of Years in Current Home, for Defaulted Customers", col = 'royalblue2')
qqline(defaulted$CURRENT_HOUSE_YRS, col = 'red')
ggplot(data=defaulted, aes(CURRENT_JOB_YRS)) +
geom_histogram(aes(y=..density..),
binwidth = 1,
col="lightpink4",
fill="lightpink2",
alpha = .7) +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(defaulted$CURRENT_JOB_YRS, na.rm = TRUE), sd = sd(defaulted$CURRENT_JOB_YRS, na.rm = TRUE))) +
labs(title="defaulted - Years in Current Job Histogram") +
labs(x="Experience", y="Frequency")
# ggplot(defaulted, aes(y=CURRENT_JOB_YRS)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Defaulted Customer Years in Current Job boxplot ",x="", y = "weight (lbs)")
qqnorm(defaulted$CURRENT_JOB_YRS, main="Q-Q plot of Years in Current Job, for Defaulted Customers", col = 'royalblue2')
qqline(defaulted$CURRENT_JOB_YRS, col = 'red')
#contigeny table
contable_housing = table(loandata$House_Ownership, loandata$Risk_Flag)
xkabledply(contable_housing, title = 'Contigency table for Risk Flag vs House Ownership ')
chitest_housing = chisq.test(contable_housing)
#To output results
chitest_housing
contable_marital = table(loandata$Married.Single, loandata$Risk_Flag)
xkabledply(contable_marital, title = 'Contigency table for Risk Flag vs Marital Status ')
chitest_marital = chisq.test(contable_marital)
chitest_marital
ttest2sample_incomes = t.test(defaulted$Income, not_defaulted$Income, alternative = 'less')
#Output results
ttest2sample_incomes
ttest2sample_currentHome = t.test(defaulted$CURRENT_HOUSE_YRS, not_defaulted$CURRENT_HOUSE_YRS, alternative = 'less')
#Output results
ttest2sample_currentHome
ttest2sample_experience <- t.test(defaulted$Experience, not_defaulted$Experience, alternative = "two.sided")
#Output results
ttest2sample_experience
ttest2sample_currentjob <- t.test(defaulted$CURRENT_JOB_YRS, not_defaulted$CURRENT_JOB_YRS)
ttest2sample_currentjob
ttest2sample_age <- t.test(defaulted$Age, not_defaulted$Age, alternative = 'less')
ttest2sample_age
#Building a histogram
#This will allow you to show two graphs at once if necessary
par(mfrow = c(2,1))
#Format: ggplot(DATASET, aes(x=VARIABLE))
#Format: labs(title = "INSERT TITLE", x="X VARIABLE NAME")
ggplot(admitted, aes(x=gpa)) +
geom_histogram(color="blue") +
labs(title = "GPA Histogram Plot", x="GPA")
ggplot(data=not_defaulted, aes(Income)) +
geom_histogram(aes(y=..density..), binwidth = 7,
col="dodgerblue4",
fill="dodgerblue2",
alpha = .7) +
labs(title="Non-defaulted Customers Income Histogram") +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$Income, na.rm = TRUE), sd = sd(not_defaulted$Income, na.rm = TRUE))) +
labs(x="Income", y="Frequency")
ggplot(data=not_defaulted, aes(Income)) +
geom_histogram(aes(y=..density..), binwidth = 10,
col="dodgerblue4",
fill="dodgerblue2",
alpha = .7) +
labs(title="Non-defaulted Customers Income Histogram") +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$Income, na.rm = TRUE), sd = sd(not_defaulted$Income, na.rm = TRUE))) +
labs(x="Income", y="Frequency")
# ggplot(not_defaulted, aes(y=Income)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Not_Defaulted Customer Income boxplot ",x="", y = "weight (lbs)")
ggplot(data=not_defaulted, aes(Income)) +
geom_histogram(aes(y=..density..), binwidth = 1000,
col="dodgerblue4",
fill="dodgerblue2",
alpha = .7) +
labs(title="Non-defaulted Customers Income Histogram") +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$Income, na.rm = TRUE), sd = sd(not_defaulted$Income, na.rm = TRUE))) +
labs(x="Income", y="Frequency")
qqnorm(not_defaulted$Income, main="Q-Q plot of Income level of Not Defaulted Customers", col = 'seagreen3')
qqline(not_defaulted$Income, col = 'red')
ggplot(data=not_defaulted, aes(Income)) +
geom_histogram(aes(y=..density..), binwidth = 10000,
col="dodgerblue4",
fill="dodgerblue2",
alpha = .7) +
labs(title="Non-defaulted Customers Income Histogram") +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$Income, na.rm = TRUE), sd = sd(not_defaulted$Income, na.rm = TRUE))) +
labs(x="Income", y="Frequency")
library(lmtest)
library(grid)
library(vcd)
str(loandata)
mosaic(~ Risk_Flag + House_Ownership ,
direction = c("v", "h"),
data = loandata,
shade = TRUE
)
#To output results
xkabledply(chitest_housing)
ggplot(data=defaulted, aes(CURRENT_JOB_YRS)) +
geom_histogram(aes(y=..density..),
binwidth = 1,
col="lightpink4",
fill="lightpink2",
alpha = .7) +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(defaulted$CURRENT_JOB_YRS, na.rm = TRUE), sd = sd(defaulted$CURRENT_JOB_YRS, na.rm = TRUE))) +
labs(title="Defaulted - Years in Current Job Histogram") +
labs(x="Experience", y="Frequency")
# ggplot(defaulted, aes(y=Income)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Defaulted Customer Income boxplot ",x="", y = "weight (lbs)")
ggplot(data=defaulted, aes(Income)) +
geom_histogram(aes(y=..density..),
col="magenta4",
fill="magenta2",
alpha = .7) +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(defaulted$Income, na.rm = TRUE), sd = sd(defaulted$Income, na.rm = TRUE))) +
labs(title="Defaulted Customers Income Histogram") +
labs(x="Income", y="Frequency")
qqnorm(defaulted$Income, main="Q-Q plot of Income level of Not Defaulted Customers", col = 'royalblue2')
qqline(defaulted$Income, col = 'red')
ggplot(data=not_defaulted, aes(CURRENT_JOB_YRS)) +
geom_histogram(aes(y=..density..), binwidth = 1,
col="burlywood4",
fill="burlywood2",
alpha = .7) +
labs(title="Non-defaulted Years in Current Job Histogram") +
stat_function(fun=dnorm, lwd = 1, col = 'red', args = list(mean = mean(not_defaulted$CURRENT_JOB_YRS, na.rm = TRUE), sd = sd(not_defaulted$CURRENT_JOB_YRS, na.rm = TRUE))) +
labs(x="Years in Current Job", y="Frequency")
# ggplot(not_defaulted, aes(y=CURRENT_JOB_YRS)) +
#   geom_boxplot() +
#   geom_boxplot( colour="orange", fill="#7777cc", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title="Not_Defaulted Years in Current Job boxplot ",x="", y = "weight (lbs)")
#
qqnorm(not_defaulted$CURRENT_JOB_YRS, main="Q-Q plot of Years in Current Job Years of Not Defaulted Customers", col = 'seagreen3')
qqline(not_defaulted$CURRENT_JOB_YRS, col = 'red')
